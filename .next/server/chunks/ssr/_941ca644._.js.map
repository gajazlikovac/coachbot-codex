{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefangajanovic/Desktop/coachbot/coachbot-codex/src/lib/models/chat.models.ts"],"sourcesContent":["import { AnalyzeStageData } from './api.models';\nimport { Style } from './instruction.models';\n\nexport interface Chat {\n  id: string;\n  name: string;\n  userId: string;\n  created_at: Date | string;\n  currentStage?: string | null;\n  ChatLifeAreas?: JSON;\n  Summary?: JSON;\n  Messages?: Message[];\n  stageAnalysis?: AnalyzeStageData;\n}\n\nexport interface Message {\n  id: string;\n  content: string;\n  originalContent?: string | null;\n  star?: boolean | null;\n  role: MessageRole | string;\n  chatId?: string;\n  created_at?: Date | string;\n  type?: string | null;\n  stage?: string | null;\n  status?: MessageStatus;\n  isLoading?: boolean;\n  error?: boolean;\n  recurring?: boolean;\n}\n\nexport enum MessageStatus {\n  generating = 'generating',\n  complete = 'complete',\n}\n\nexport enum MessageRole {\n  user = 'user',\n  assistant = 'assistant',\n}\n\nexport enum ChatMode {\n  new = 'new',\n  recurring = 'recurring',\n}\n\nexport interface ChatInfo {\n  stage: string;\n  style: Style | null;\n  mode: ChatMode;\n}\n"],"names":[],"mappings":";;;;;AA+BO,IAAA,AAAK,uCAAA;;;WAAA;;AAKL,IAAA,AAAK,qCAAA;;;WAAA;;AAKL,IAAA,AAAK,kCAAA;;;WAAA","debugId":null}},
    {"offset": {"line": 33, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefangajanovic/Desktop/coachbot/coachbot-codex/src/lib/utils/chat.utils.ts"],"sourcesContent":["import { AnalyzeStageData } from '../models/api.models';\nimport { ChatInfo, ChatMode, Message, MessageRole } from '../models/chat.models';\nimport { SessionDetailsTab } from '../models/common.models';\nimport { Locale } from '../models/locale.models';\n\n/**\n * Generates a formatted chat session name with the current day and time\n * Format: \"Session - Day [HH:MM]\" (e.g., \"Session - Mon [14:30]\")\n * @returns {string} Formatted session name\n */\nexport const generateSessionName = (locale: Locale | string = 'en-US'): string => {\n  const now = new Date();\n\n  // Get day abbreviation (Mon, Tue, etc.)\n  const day = now.toLocaleDateString(locale, { weekday: 'short' });\n\n  // Get hours and minutes with padding\n  const hours = now.getHours().toString().padStart(2, '0');\n  const minutes = now.getMinutes().toString().padStart(2, '0');\n\n  return `Session - ${day} [${hours}:${minutes}]`;\n};\n\n/**\n * Generates a UUID v4 string with fallback for environments without crypto.randomUUID\n * @returns {string} UUID v4 string\n */\nexport const generateUUID = (): string => {\n  if (typeof crypto !== 'undefined' && typeof crypto.randomUUID === 'function') {\n    return crypto.randomUUID();\n  }\n\n  // Fallback implementation\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n    const r = (Math.random() * 16) | 0;\n    const v = c === 'x' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n};\n\nexport const getMessage = (content: string, role: MessageRole, { stage, mode }: ChatInfo): Message => ({\n  id: generateUUID(),\n  content,\n  stage,\n  role,\n  created_at: new Date().toISOString(),\n  recurring: mode === ChatMode.recurring,\n});\n\nexport const mapSessionStageAnalysis = (data?: AnalyzeStageData): SessionDetailsTab[] | undefined => {\n  if (!data?.reasoning || !data?.criteria_missing) {\n    return [{ name: 'Details', descriptions: [] }];\n  }\n\n  return [\n    {\n      name: 'Details',\n      descriptions: [\n        { type: 'text', value: data.reasoning },\n        {\n          type: 'list',\n          value: data.criteria_missing.map((item) => `▪︎  ${item}`),\n          title: data.criteria_missing.length ? 'Missing Criterias' : '',\n        },\n      ],\n    },\n  ];\n};\n"],"names":[],"mappings":";;;;;;AACA;;AASO,MAAM,sBAAsB,CAAC,SAA0B,OAAO;IACnE,MAAM,MAAM,IAAI;IAEhB,wCAAwC;IACxC,MAAM,MAAM,IAAI,kBAAkB,CAAC,QAAQ;QAAE,SAAS;IAAQ;IAE9D,qCAAqC;IACrC,MAAM,QAAQ,IAAI,QAAQ,GAAG,QAAQ,GAAG,QAAQ,CAAC,GAAG;IACpD,MAAM,UAAU,IAAI,UAAU,GAAG,QAAQ,GAAG,QAAQ,CAAC,GAAG;IAExD,OAAO,CAAC,UAAU,EAAE,IAAI,EAAE,EAAE,MAAM,CAAC,EAAE,QAAQ,CAAC,CAAC;AACjD;AAMO,MAAM,eAAe;IAC1B,IAAI,OAAO,WAAW,eAAe,OAAO,OAAO,UAAU,KAAK,YAAY;QAC5E,OAAO,OAAO,UAAU;IAC1B;IAEA,0BAA0B;IAC1B,OAAO,uCAAuC,OAAO,CAAC,SAAS,CAAC;QAC9D,MAAM,IAAI,AAAC,KAAK,MAAM,KAAK,KAAM;QACjC,MAAM,IAAI,MAAM,MAAM,IAAI,AAAC,IAAI,MAAO;QACtC,OAAO,EAAE,QAAQ,CAAC;IACpB;AACF;AAEO,MAAM,aAAa,CAAC,SAAiB,MAAmB,EAAE,KAAK,EAAE,IAAI,EAAY,GAAc,CAAC;QACrG,IAAI;QACJ;QACA;QACA;QACA,YAAY,IAAI,OAAO,WAAW;QAClC,WAAW,SAAS,sIAAA,CAAA,WAAQ,CAAC,SAAS;IACxC,CAAC;AAEM,MAAM,0BAA0B,CAAC;IACtC,IAAI,CAAC,MAAM,aAAa,CAAC,MAAM,kBAAkB;QAC/C,OAAO;YAAC;gBAAE,MAAM;gBAAW,cAAc,EAAE;YAAC;SAAE;IAChD;IAEA,OAAO;QACL;YACE,MAAM;YACN,cAAc;gBACZ;oBAAE,MAAM;oBAAQ,OAAO,KAAK,SAAS;gBAAC;gBACtC;oBACE,MAAM;oBACN,OAAO,KAAK,gBAAgB,CAAC,GAAG,CAAC,CAAC,OAAS,CAAC,IAAI,EAAE,MAAM;oBACxD,OAAO,KAAK,gBAAgB,CAAC,MAAM,GAAG,sBAAsB;gBAC9D;aACD;QACH;KACD;AACH","debugId":null}},
    {"offset": {"line": 103, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefangajanovic/Desktop/coachbot/coachbot-codex/src/server/db/chatClient.ts"],"sourcesContent":["import { cache } from 'react';\nimport { Chat, Message } from '@prisma/client';\n\nimport prisma from '@/lib/prisma';\nimport { Chat as ChatModel } from '../../lib/models/chat.models';\n\nexport const getUserChat = cache(\n  async (id: string, userId: string): Promise<(Chat & { Messages: Message[] }) | null> => {\n    try {\n      return prisma.chat.findFirst({\n        where: { id, userId },\n        include: {\n          Messages: {\n            orderBy: {\n              created_at: 'desc',\n            },\n          },\n        },\n      });\n    } catch (error) {\n      console.error(`[chatClient] Error fetching chat ${id}:`, error);\n\n      return null;\n    }\n  }\n);\n\nexport const getUserChats = async (userId: string): Promise<ChatModel[] | null> => {\n  try {\n    const chats = await prisma.chat.findMany({\n      where: { userId },\n      orderBy: {\n        created_at: 'desc',\n      },\n    });\n\n    return chats.map((chat: Chat) => ({\n      ...chat,\n      stageAnalysis: typeof chat.stageAnalysis === 'string' ? JSON.parse(chat.stageAnalysis) : chat.stageAnalysis,\n    }));\n  } catch (error) {\n    console.error(`[chatClient] Error fetching user ${userId} chats:`, error);\n\n    return null;\n  }\n};\n\nexport const createChat = async (userId: string, chat: any): Promise<Chat> => {\n  try {\n    const createdChat = await prisma.chat.create({ data: { ...chat, userId }, include: { Messages: true } });\n\n    return createdChat;\n  } catch (error) {\n    console.error(`[chatClient] Error creating chat for user ${userId}:`, error);\n\n    throw new Error('[chatClient] Could not create new chat');\n  }\n};\n\nexport const updateUserChat = async (id: string, data: any): Promise<Chat> => {\n  try {\n    const result = await prisma.chat.update({ where: { id }, data: { ...data }, include: { Messages: true } });\n\n    return result;\n  } catch (error) {\n    console.log(`[chatActions debugger] updating chat ${id} error`, JSON.stringify(error));\n    console.error(`[chatClient] Error updating chat ${id}:`, error);\n\n    throw new Error('[chatClient] Could not upadte chat');\n  }\n};\n\nexport const removeChat = async (userId: string, id: string): Promise<Chat> => {\n  try {\n    return prisma.chat.delete({ where: { userId, id } });\n  } catch (error) {\n    console.error(`[chatClient] Error removing chat ${id}:`, error);\n\n    throw new Error('[chatClient] Could not remove chat');\n  }\n};\n\nexport const createChatMessage = async (chatId: string, message: any): Promise<Message> => {\n  try {\n    return await prisma.message.create({ data: { ...message, chatId, created_at: new Date(message.created_at) } });\n  } catch (error) {\n    console.error(`[chatClient] Error during creating message for chat ${chatId}:`, error);\n\n    throw new Error('[chatClient] Could not create chat message');\n  }\n};\n\nexport const updateMessage = async (id: string, data: Partial<Message>): Promise<Message> => {\n  try {\n    return await prisma.message.update({\n      where: { id },\n      data,\n    });\n  } catch (error) {\n    console.error(`[chatClient] Error during updating message  ${id}:`, error);\n\n    throw new Error('[chatClient] Could not upadte message');\n  }\n};\n\nexport const updateLastMessageInChat = async (chatId: string, data: Partial<Message>): Promise<Message | null> => {\n  try {\n    const lastMessage = await prisma.message.findFirst({\n      where: { chatId },\n      orderBy: { created_at: 'desc' },\n    });\n\n    if (!lastMessage) return null;\n\n    return await updateMessage(lastMessage.id, data);\n  } catch (error) {\n    console.error(`[chatClient] Error updating last message in chat ${chatId}:`, error);\n\n    throw new Error('[chatClient] Could not update last message');\n  }\n};\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 256, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefangajanovic/Desktop/coachbot/coachbot-codex/src/server/db/apiClient.ts"],"sourcesContent":["import { CoachingPayload, CoachingResponse } from '@/lib/models/api.models';\n\nexport enum ApiPath {\n  coaching = '/coaching',\n}\n\nexport enum ResponseContentType {\n  text = 'text/plain',\n  json = 'application/json',\n}\n\nexport class ApiClient {\n  private readonly config: any;\n\n  constructor() {\n    this.config = {\n      baseUrl: process.env.AI_API_BASE_URL || '',\n    };\n  }\n\n  private async makePostRequest<T>(\n    endpoint: string,\n    data: T,\n    tag?: string,\n    method: 'POST' | 'PUT' = 'POST'\n  ): Promise<any> {\n    try {\n      const response = await fetch(`${this.config.baseUrl}${endpoint}`, {\n        method,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(data),\n        next: { tags: [tag || endpoint] },\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n\n        console.error(error);\n        throw new Error(\n          `[apiClient] ${method} Request failed with status ${response.status}, error: ${JSON.stringify(error)}`\n        );\n      }\n\n      return response.headers.get('content-type') === ResponseContentType.json ? response.json() : response.text();\n    } catch (error) {\n      console.error(`[aiApiClient] ${endpoint} error:`, error);\n\n      throw new Error(`[aiApi] Failed to make ${method} request to ${endpoint}`);\n    }\n  }\n\n  public async sendMessage(payload: CoachingPayload): Promise<CoachingResponse> {\n    return this.makePostRequest(\n      ApiPath.coaching,\n      {\n        ...payload,\n        messages: payload.history.map(({ created_at, ...message }) => message),\n        newMessage: { ...payload.newMessage, created_at: undefined },\n      },\n      'chat_coaching'\n    );\n  }\n}\n\nexport const apiClient = new ApiClient();\n"],"names":[],"mappings":";;;;;;AAEO,IAAA,AAAK,iCAAA;;WAAA;;AAIL,IAAA,AAAK,6CAAA;;;WAAA;;AAKL,MAAM;IACM,OAAY;IAE7B,aAAc;QACZ,IAAI,CAAC,MAAM,GAAG;YACZ,SAAS,QAAQ,GAAG,CAAC,eAAe,IAAI;QAC1C;IACF;IAEA,MAAc,gBACZ,QAAgB,EAChB,IAAO,EACP,GAAY,EACZ,SAAyB,MAAM,EACjB;QACd,IAAI;YACF,MAAM,WAAW,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,UAAU,EAAE;gBAChE;gBACA,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;gBACrB,MAAM;oBAAE,MAAM;wBAAC,OAAO;qBAAS;gBAAC;YAClC;YAEA,IAAI,CAAC,SAAS,EAAE,EAAE;gBAChB,MAAM,QAAQ,MAAM,SAAS,IAAI;gBAEjC,QAAQ,KAAK,CAAC;gBACd,MAAM,IAAI,MACR,CAAC,YAAY,EAAE,OAAO,4BAA4B,EAAE,SAAS,MAAM,CAAC,SAAS,EAAE,KAAK,SAAS,CAAC,QAAQ;YAE1G;YAEA,OAAO,SAAS,OAAO,CAAC,GAAG,CAAC,yCAA+C,SAAS,IAAI,KAAK,SAAS,IAAI;QAC5G,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,CAAC,cAAc,EAAE,SAAS,OAAO,CAAC,EAAE;YAElD,MAAM,IAAI,MAAM,CAAC,uBAAuB,EAAE,OAAO,YAAY,EAAE,UAAU;QAC3E;IACF;IAEA,MAAa,YAAY,OAAwB,EAA6B;QAC5E,OAAO,IAAI,CAAC,eAAe,cAEzB;YACE,GAAG,OAAO;YACV,UAAU,QAAQ,OAAO,CAAC,GAAG,CAAC,CAAC,EAAE,UAAU,EAAE,GAAG,SAAS,GAAK;YAC9D,YAAY;gBAAE,GAAG,QAAQ,UAAU;gBAAE,YAAY;YAAU;QAC7D,GACA;IAEJ;AACF;AAEO,MAAM,YAAY,IAAI","debugId":null}},
    {"offset": {"line": 321, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefangajanovic/Desktop/coachbot/coachbot-codex/src/server/actions/messagesAction.ts"],"sourcesContent":["'use server';\n\nimport { revalidatePath } from 'next/cache';\n\nimport { MessageSendPayload } from '@/lib/models/api.models';\nimport { Message, MessageRole } from '@/lib/models/chat.models';\nimport { getMessage } from '@/lib/utils/chat.utils';\nimport { apiClient } from '../db/apiClient';\nimport { createChatMessage, updateMessage } from '../db/chatClient';\n\nexport async function createChatMessages(userId: string, messages: Message[], chatId?: string): Promise<string> {\n  try {\n    await Promise.all(\n      messages.map(\n        async (message: Message) => await createChatMessage(chatId || '', { ...message, recurring: undefined })\n      )\n    );\n\n    return chatId || '';\n  } catch (error) {\n    console.error(`[messagesActions] Error during updating chat ${chatId} with messages for user ${userId} :`, error);\n\n    return '';\n  }\n}\n\nexport async function sendMessage({\n  userId,\n  assistantId,\n  newMessage,\n  prevMessages,\n  chat_id,\n  chatInfo,\n}: MessageSendPayload): Promise<string> {\n  try {\n    const payload = {\n      assistant_id: assistantId,\n      user_id: userId,\n      chat_id,\n      current_stage: chatInfo.stage,\n      history: [...prevMessages.reverse()],\n      newMessage,\n      app: 'studio',\n    };\n\n    const { response } = await apiClient.sendMessage(payload);\n    const assistantMessage = {\n      ...getMessage(response, MessageRole.assistant, chatInfo),\n      created_at: new Date().toISOString(),\n    };\n\n    const chatId = await createChatMessages(userId, [newMessage, assistantMessage], chat_id);\n\n    revalidatePath(`/chat/${chatId}`);\n\n    return chatId;\n  } catch (error) {\n    console.error(`[messagesActions] Error sending user ${userId} message: `, error);\n    return '';\n  }\n}\n\nexport async function editMessage(id: string, message: Partial<Message>): Promise<Message | null> {\n  try {\n    return await updateMessage(id, message as any);\n  } catch (error: any) {\n    console.error(`[messagesActions] Error updating message ${id} data: `, error);\n    return null;\n  }\n}\n"],"names":[],"mappings":";;;;;;;AAEA;AAGA;AACA;AACA;AACA;;;;;;;;;AAEO,eAAe,mBAAmB,MAAc,EAAE,QAAmB,EAAE,MAAe;IAC3F,IAAI;QACF,MAAM,QAAQ,GAAG,CACf,SAAS,GAAG,CACV,OAAO,UAAqB,MAAM,CAAA,GAAA,iIAAA,CAAA,oBAAiB,AAAD,EAAE,UAAU,IAAI;gBAAE,GAAG,OAAO;gBAAE,WAAW;YAAU;QAIzG,OAAO,UAAU;IACnB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,CAAC,6CAA6C,EAAE,OAAO,wBAAwB,EAAE,OAAO,EAAE,CAAC,EAAE;QAE3G,OAAO;IACT;AACF;AAEO,eAAe,YAAY,EAChC,MAAM,EACN,WAAW,EACX,UAAU,EACV,YAAY,EACZ,OAAO,EACP,QAAQ,EACW;IACnB,IAAI;QACF,MAAM,UAAU;YACd,cAAc;YACd,SAAS;YACT;YACA,eAAe,SAAS,KAAK;YAC7B,SAAS;mBAAI,aAAa,OAAO;aAAG;YACpC;YACA,KAAK;QACP;QAEA,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM,gIAAA,CAAA,YAAS,CAAC,WAAW,CAAC;QACjD,MAAM,mBAAmB;YACvB,GAAG,CAAA,GAAA,oIAAA,CAAA,aAAU,AAAD,EAAE,UAAU,sIAAA,CAAA,cAAW,CAAC,SAAS,EAAE,SAAS;YACxD,YAAY,IAAI,OAAO,WAAW;QACpC;QAEA,MAAM,SAAS,MAAM,mBAAmB,QAAQ;YAAC;YAAY;SAAiB,EAAE;QAEhF,CAAA,GAAA,6HAAA,CAAA,iBAAc,AAAD,EAAE,CAAC,MAAM,EAAE,QAAQ;QAEhC,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,CAAC,qCAAqC,EAAE,OAAO,UAAU,CAAC,EAAE;QAC1E,OAAO;IACT;AACF;AAEO,eAAe,YAAY,EAAU,EAAE,OAAyB;IACrE,IAAI;QACF,OAAO,MAAM,CAAA,GAAA,iIAAA,CAAA,gBAAa,AAAD,EAAE,IAAI;IACjC,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,CAAC,yCAAyC,EAAE,GAAG,OAAO,CAAC,EAAE;QACvE,OAAO;IACT;AACF;;;IA3DsB;IAgBA;IAoCA;;AApDA,+OAAA;AAgBA,+OAAA;AAoCA,+OAAA","debugId":null}},
    {"offset": {"line": 405, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefangajanovic/Desktop/coachbot/coachbot-codex/src/server/actions/chatActions.ts"],"sourcesContent":["'use server';\n\nimport { revalidateTag } from 'next/cache';\n\nimport { AnalyzeStageData } from '@/lib/models/api.models';\nimport { Chat, ChatInfo, Message } from '@/lib/models/chat.models';\nimport { generateSessionName } from '@/lib/utils/chat.utils';\nimport {\n  createChat,\n  getUserChat,\n  getUserChats,\n  removeChat,\n  updateLastMessageInChat,\n  updateUserChat,\n} from '../db/chatClient';\nimport { getFirstStage } from './instructionsActions';\nimport { sendMessage } from './messagesAction';\nimport { getSessionUser, verifySession } from './sessionActions';\n\nexport async function handleStageAnalysis(chatId: string, stageAnalysis: AnalyzeStageData | null): Promise<void> {\n  try {\n    if (!stageAnalysis) return;\n\n    const { transition_required, current_stage, next_stage } = stageAnalysis;\n\n    const [chat] = await Promise.all([\n      updateUserChat(chatId, {\n        stageAnalysis,\n        currentStage: transition_required ? next_stage : current_stage,\n      }),\n      updateLastMessageInChat(chatId, { stageAnalysis: JSON.stringify(stageAnalysis) }),\n    ]);\n\n    const eventEmitter = (await import('@/lib/eventEmitter')).default;\n    eventEmitter.emit(`message:${chat.userId}`, {\n      user_id: chat.userId,\n      event: 'chat-update',\n      data: { chatId: chat.id, type: 'stage-analysis' },\n    });\n  } catch (error) {\n    console.error(`[chatActions] error during saving chat ${chatId} stage analysis`, error);\n  }\n}\n\nexport async function getChats(): Promise<any> {\n  let userId;\n  try {\n    userId = await getSessionUser();\n\n    return userId ? await getUserChats(userId) : [];\n  } catch (error) {\n    console.error(`[chatsActions] Error fetching user ${userId} chats:`, error);\n\n    return [];\n  }\n}\n\nexport async function getChat(id: string): Promise<Chat | null> {\n  let userId;\n  try {\n    userId = await getSessionUser();\n\n    if (!userId) return null;\n\n    const chat = await getUserChat(id, userId);\n\n    return chat as any;\n  } catch (error) {\n    console.error(`[chatsActions] Error fetching user ${userId} chats:`, error);\n\n    return null;\n  }\n}\n\nexport async function deleteChat(chatId: string) {\n  let user_id;\n  try {\n    user_id = (await getSessionUser()) || '';\n    await removeChat(user_id, chatId);\n\n    revalidateTag(`chats`);\n  } catch (error) {\n    console.error(`[chatsActions] Error during deleting userr ${user_id} chat ${chatId}: `, error);\n  }\n}\n\nexport async function createNewChat(userId: string, assistantId: string): Promise<string> {\n  try {\n    const firstStage = await getFirstStage();\n    const newChat = await createChat(userId, {\n      currentStage: firstStage?.name,\n      name: generateSessionName(),\n      assistantId,\n    });\n\n    return newChat.id;\n  } catch (error) {\n    console.error(`[chatsActions] Error creating new chat for user ${userId}:`, error);\n\n    return '';\n  }\n}\n\nexport async function updateChat(\n  currentChatId: string | undefined,\n  messages: Message[],\n  chatInfo: ChatInfo\n): Promise<string> {\n  let user_id;\n  try {\n    const { userId, assistantId } = (await verifySession()) || {};\n    user_id = userId;\n\n    if (!userId || !assistantId) return '';\n\n    const [newMessage, ...prevMessages] = messages;\n    const chat_id = currentChatId || (await createNewChat(userId, assistantId));\n    await sendMessage({ userId, assistantId, newMessage, prevMessages, chat_id, chatInfo });\n\n    !currentChatId && revalidateTag(`chats`);\n    // TODO: instead revalidate try to return assistant message directly\n    return chat_id;\n  } catch (error) {\n    console.error(`[chatsActions] Error fetching user ${user_id} chats:`, error);\n\n    return '';\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 552, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefangajanovic/Desktop/coachbot/coachbot-codex/.next-internal/server/app/%28main%29/instructions/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getUser as '00f493e29254b15d58fd88f4f4d1857033e824e6ed'} from 'ACTIONS_MODULE0'\nexport {updateUserData as '400fe5b7eae332f55d1570f77f67fb4880e1da66cc'} from 'ACTIONS_MODULE0'\nexport {checkExistingSubscription as '40617daf5d15e4fe06aa3748fbde57cacd4e5c5d76'} from 'ACTIONS_MODULE0'\nexport {deleteUserAccount as '40a3be75c021cc8c57fca1bced4da32245d8a3953c'} from 'ACTIONS_MODULE0'\nexport {checkSignupModeParam as '40a5355ded58ddab19047239cd1337c2b15c013a91'} from 'ACTIONS_MODULE0'\nexport {checkUserAccessAllowed as '40bf5ddfac312f9fe15288cb868c5f0f1a4e7e93ca'} from 'ACTIONS_MODULE0'\nexport {checkUserSubscription as '40ef050ad81136482a8d47b0d661448d7bbda3e264'} from 'ACTIONS_MODULE0'\nexport {updateUserAccount as '60ded4edc2884943f0f937f1dd06d3a3b355ee8d80'} from 'ACTIONS_MODULE0'\nexport {getUserCurrentSubscription as '7f0243638d1fa053b2e125009415e7b77415e7f4e5'} from 'ACTIONS_MODULE1'\nexport {createUserCheckoutSession as '7f08abd42661a1d1fc10ca23e45fa97939bd5771c6'} from 'ACTIONS_MODULE1'\nexport {getUserCurrentPrice as '7f113408b23342dd27bf91e0930201c3c5566814e0'} from 'ACTIONS_MODULE1'\nexport {cancelUserSubscription as '7f38162c1e1ea25645b01b7fc46a9331f8c1f1aa8c'} from 'ACTIONS_MODULE1'\nexport {updateSubscriptionData as '7f6164fb8f7fd92f23914d018279d0565c333c0629'} from 'ACTIONS_MODULE1'\nexport {getPrices as '7f701abfe2f6c437c5e0e355c09e5ca36a214ae4a5'} from 'ACTIONS_MODULE1'\nexport {createUserFreeSubscription as '7f9a3527417a97f0dbec6de5bb446d53c23c76c472'} from 'ACTIONS_MODULE1'\nexport {getCancelSubscriptionData as '7fc8c3060d63dea28a0d23655d8caa453b2dd0fe13'} from 'ACTIONS_MODULE1'\nexport {getUpdatedSubscriptionData as '7fde1dc949db0e2923ce796360116e9428281d8fab'} from 'ACTIONS_MODULE1'\nexport {mapStripePrices as '7fe99dde7a8504d1c0b5ebc320c25fadce39c7bd02'} from 'ACTIONS_MODULE1'\nexport {deleteSession as '003ced715dcb142a06df1c477a7bce1d57c1a0fb1e'} from 'ACTIONS_MODULE2'\nexport {verifySession as '0069ba96f7d5387663470cd879b3d1c554f9078a61'} from 'ACTIONS_MODULE2'\nexport {getSessionUser as '006d0a7129916a3465564fabe7ab4818da32dc51a1'} from 'ACTIONS_MODULE2'\nexport {updateSession as '70425448e81a40aaef871c95f3f46f2a736857ca6f'} from 'ACTIONS_MODULE2'\nexport {createSession as '70e4de43e28aaa533b33b7452ebbfe624254ef9332'} from 'ACTIONS_MODULE2'\nexport {getCurrentAssistant as '004c1af4f6b28a4d4829101b2c2ca0a5fc13d22c46'} from 'ACTIONS_MODULE3'\nexport {getTemplates as '00b009a3a1a8f8d6ed1d56b0b485271ca245dab4a6'} from 'ACTIONS_MODULE3'\nexport {createCopyAssistant as '40bdb1594d9d7edf733766ff35336b4ac35eebc785'} from 'ACTIONS_MODULE3'\nexport {getAssistants as '40c332244832b5fdde6acf9572f43631ec3730cc4a'} from 'ACTIONS_MODULE3'\nexport {deleteAssistant as '40dd6c761bfb7b8f199153b185c56dac7979a243bb'} from 'ACTIONS_MODULE3'\nexport {getAssistantConfiguration as '6046d8b5cb687c98387129f0a27c6dc38e3cdcbd6a'} from 'ACTIONS_MODULE3'\nexport {updateAssistantMetaPrice as '607001410e8288ea9d2e2ad99c1ae2b7836a8ac437'} from 'ACTIONS_MODULE3'\nexport {updateAssistantMetaData as '6087e5f7a8234752547ec717956fbb5e6cbf5c6c85'} from 'ACTIONS_MODULE3'\nexport {upsertAssistant as '608a31f9228c5cb99f63322f7be67da509d292f5cd'} from 'ACTIONS_MODULE3'\nexport {getModerationRules as '004ddef650aed9fe805628bc98e161f4e1e980ce2b'} from 'ACTIONS_MODULE4'\nexport {getStyles as '0077229e3d182bc284cbfa4ef3021cb7694d760dca'} from 'ACTIONS_MODULE4'\nexport {getFirstStage as '00d3e1757c5668df7e38eadbdd7f79edc884195db1'} from 'ACTIONS_MODULE4'\nexport {updateModerationTemplate as '4018216bff0b6f1e453bf1d5d3660e338536eeff46'} from 'ACTIONS_MODULE4'\nexport {deleteStyle as '40218a5e4dc83ff346dbaf09022aef2ff5549497e8'} from 'ACTIONS_MODULE4'\nexport {createStage as '40454bf6a6b30fb871b51f86a6e440956bd6db8862'} from 'ACTIONS_MODULE4'\nexport {createStyle as '404bdcdd0b88d2a1726c792f9e9e6ef5d1674d8355'} from 'ACTIONS_MODULE4'\nexport {updateStyle as '404fa2ec160e9f9b7dd7736f513451f3308bf49486'} from 'ACTIONS_MODULE4'\nexport {deleteModerationTemplate as '4050c500a291e41ed54d67d1854209ca9da875ea4b'} from 'ACTIONS_MODULE4'\nexport {getStages as '40c4d67ce1cc5bd4adf3a04a64a98f16c28de17466'} from 'ACTIONS_MODULE4'\nexport {deleteModerationRule as '40d284512e242fb21f0392863f87c70d34935c4496'} from 'ACTIONS_MODULE4'\nexport {deleteStage as '40e40e5b27cf322d651077fb8001e33f1f13c1ff3d'} from 'ACTIONS_MODULE4'\nexport {createModerationRule as '40e96a14d916136b397df63703b685b189b46784e0'} from 'ACTIONS_MODULE4'\nexport {updateConfigInstructions as '40f893ccb0638b828a20025d89e6a398dc0f8db092'} from 'ACTIONS_MODULE4'\nexport {createModerationTemplate as '60bd862308545c711b3ea3493a03d8f9abf64726ec'} from 'ACTIONS_MODULE4'\nexport {updateStage as '60debe2174dde7cc9aab31e93e27b411122bcefad9'} from 'ACTIONS_MODULE4'\nexport {updateStyleTitle as '60f094ac314e8e904bb1373095893a894f3a069a35'} from 'ACTIONS_MODULE4'\nexport {updateStageOrder as '7051b13a06fd32d89aaff7a6649bffeef191565577'} from 'ACTIONS_MODULE4'\nexport {updateModerationRule as '70b14c6d1fd92bcf0c63f6338147808e4772544546'} from 'ACTIONS_MODULE4'\nexport {upsertAssistantPrice as '6003919541e7ca4488840d5713a45132f092dc1514'} from 'ACTIONS_MODULE5'\nexport {deleteUserAssistant as '6014d229b861db0ebf4d17c62051c9024dac7515a3'} from 'ACTIONS_MODULE5'\nexport {updateAssistantMeta as '60609ec3e970ab2cde7aca948cb02d539165d26951'} from 'ACTIONS_MODULE5'\nexport {updateUserAssistant as '70c57c267417fba476421bdc7dd6bc96db9bdc3df6'} from 'ACTIONS_MODULE5'\nexport {getUserAssitants as '7f08500eb6467ef932d5f32cbc7aa1088805e67046'} from 'ACTIONS_MODULE5'\nexport {getAssistans as '7f2cb1e96e28336177c356ac9d1e1653445fa52dcd'} from 'ACTIONS_MODULE5'\nexport {duplicateAssistant as '7f34dd803ff77dff9812100e54e5b1999fafa07871'} from 'ACTIONS_MODULE5'\nexport {getAssistantData as '7f85937f3e79d0ec0ed2e0e658e9d897d80439b7bd'} from 'ACTIONS_MODULE5'\nexport {createUserAssistant as '7fb52fafb31e6f17fb7c40ab1ee063267ee158e571'} from 'ACTIONS_MODULE5'\nexport {getAllTemplates as '7ff4257cec1cc8c98b65e9b54d1d17c02c7c486159'} from 'ACTIONS_MODULE5'\nexport {getChat as '4070d78f346fa39de08469d427f476fea48c088df6'} from 'ACTIONS_MODULE6'\n"],"names":[],"mappings":";AAAA;AAQA;AAUA;AAKA;AASA;AAmBA;AAUA","debugId":null}},
    {"offset": {"line": 861, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefangajanovic/Desktop/coachbot/coachbot-codex/src/app/%40modal/%5B...catchAll%5D/page.tsx"],"sourcesContent":["export default function CatchAll() {\n  return null;\n}\n"],"names":[],"mappings":";;;AAAe,SAAS;IACtB,OAAO;AACT","debugId":null}}]
}